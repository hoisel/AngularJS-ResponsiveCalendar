function CalendarController($scope,$attrs,$interpolate,$log,$mdMedia,$mdColors,dateFilter,calendarConfig){"use strict";function onDataLoaded(){var row,date,st,et,eventSet,rowIndex,dayIndex,i,index,timeDifferenceStart,timeDifferenceEnd,event,eventStartTime,eventEndTime,events=vm.eventSource,len=events?events.length:0,startTime=vm.range.startTime,endTime=vm.range.endTime,weeks=vm.weeks,oneDay=864e5,eps=.001,hasEvent=!1,findSelected=!1;if(weeks.hasEvent)for(row=0;6>row;row+=1)for(date=0;7>date;date+=1)weeks[row][date].hasEvent&&(weeks[row][date].events=null,weeks[row][date].hasEvent=!1);for(i=0;len>i;i+=1)if(event=events[i],eventStartTime=new Date(event.startTime),eventEndTime=new Date(event.endTime),!(startTime>=eventEndTime||eventStartTime>=endTime))for(st=startTime,et=endTime,timeDifferenceStart=st>=eventStartTime?0:(eventStartTime-st)/oneDay,timeDifferenceEnd=eventEndTime>=et?(et-st)/oneDay:(eventEndTime-st)/oneDay,index=Math.floor(timeDifferenceStart);timeDifferenceEnd-eps>index;)rowIndex=Math.floor(index/7),dayIndex=Math.floor(index%7),weeks[rowIndex][dayIndex].hasEvent=!0,eventSet=weeks[rowIndex][dayIndex].events,eventSet?eventSet.push(event):(eventSet=[],eventSet.push(event),weeks[rowIndex][dayIndex].events=eventSet),index+=1;for(row=0;6>row;row+=1)for(date=0;7>date;date+=1)weeks[row][date].hasEvent&&(hasEvent=!0,weeks[row][date].events.sort(compareEvent));for(weeks.hasEvent=hasEvent,row=0;6>row;row+=1){for(date=0;7>date;date+=1)if(weeks[row][date].selected){vm.selectedDate=weeks[row][date],findSelected=!0;break}if(findSelected)break}}function onViewRefreshed(){"local"===vm.queryMode?vm.eventSource&&onDataLoaded&&onDataLoaded():"remote"===vm.queryMode&&vm.viewRefreshed&&vm.viewRefreshed({selectedDate:vm._selectedDate,range:vm.range})}function attachDaysMetadata(days,month){var i;for(i=0;42>i;i++)angular.extend(days[i],createDayMetadata(days[i]),{secondary:days[i].getMonth()!==month})}function createDayMetadata(day){return{label:dateFilter(day,vm.formatDay),headerLabel:dateFilter(day,vm.formatDayHeader),selected:0===compare(day,vm._selectedDate),current:0===compare(day,new Date)}}function createDaysLabels(days){var j,labels=new Array(7);for(j=0;7>j;j++)labels[j]=dateFilter(days[j],vm.formatDayHeader);return labels}function generateNDaysFrom(startDate,n){var days=new Array(n),current=new Date(startDate),i=0;for(current.setHours(12);n>i;)days[i++]=new Date(current),current.setDate(current.getDate()+1);return days}function validateDate($viewValue){var date=new Date($viewValue),isValid=!isNaN(date);return isValid||($log.error('"ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),$log.info("using current date as ngModel")),ngModelCtrl.$setValidity("date",isValid),isValid?$viewValue:null}function compare(date1,date2){return new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate())}function compareEvent(event1,event2){return event1.startTime.getTime()-event2.startTime.getTime()}function refreshView(){var startDate,day,month,year,headerDate,days;vm.mode&&(vm.range=getRange(vm._selectedDate),startDate=vm.range.startTime,day=startDate.getDate(),month=(startDate.getMonth()+(1!==day?1:0))%12,year=startDate.getFullYear()+(1!==day&&0===month?1:0),headerDate=new Date(year,month,1),days=generateNDaysFrom(startDate,42),attachDaysMetadata(days,month),vm.labels=createDaysLabels(days),vm.title=dateFilter(headerDate,vm.formatMonthTitle),vm.weeks=split(days,7),onViewRefreshed())}function split(arr,size){for(var arrays=[];arr.length>0;)arrays.push(arr.splice(0,size));return arrays}function getRange(currentDate){var endDate,year=currentDate.getFullYear(),month=currentDate.getMonth(),firstDayOfMonth=new Date(year,month,1),difference=vm.startingDay-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,startDate=new Date(firstDayOfMonth);return numDisplayedFromPreviousMonth>0&&startDate.setDate(-numDisplayedFromPreviousMonth+1),endDate=new Date(startDate),endDate.setDate(endDate.getDate()+42),{startTime:startDate,endTime:endDate}}var vm=this,ngModelCtrl={$setViewValue:angular.noop};angular.forEach(["formatDay","formatDayHeader","formatDayTitle","formatMonthTitle","formatHourColumn","startingDay","eventSource","queryMode"],function(key,index){vm[key]=angular.isDefined($attrs[key])?4>index?$interpolate($attrs[key])($scope.$parent):$scope.$parent.$eval($attrs[key]):calendarConfig[key]}),$scope.$parent.$watch($attrs.eventSource,function(value){vm.onEventSourceChanged(value)}),vm.defaultEventColor=$mdColors.getThemeColor("accent"),vm.$mdMedia=$mdMedia,vm.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$formatters.push(validateDate),ngModelCtrl.$render=function(){vm._selectedDate=ngModelCtrl.$viewValue||new Date,refreshView()}},vm.onEventSourceChanged=function(eventSource){vm.eventSource=eventSource,onDataLoaded&&onDataLoaded()},vm.moveMonth=function(step){var year=vm._selectedDate.getFullYear(),month=vm._selectedDate.getMonth()+step,date=vm._selectedDate.getDate(),newDate=new Date(year,month,date),firstDayInNextMonth=new Date(year,month+1,1);firstDayInNextMonth.getTime()<=newDate.getTime()&&(newDate=new Date(firstDayInNextMonth-864e5)),vm._selectedDate=newDate,ngModelCtrl.$setViewValue(newDate),refreshView()},vm.moveDay=function(step){var _selectedDate=vm._selectedDate,year=_selectedDate.getFullYear(),month=_selectedDate.getMonth(),date=_selectedDate.getDate()+step,newDate=new Date(year,month,date);vm._selectedDate=newDate,ngModelCtrl.$setViewValue(newDate),refreshView()},vm.select=function(selectedDate){var currentMonth,currentYear,selectedMonth,selectedYear,direction,selected,row,date,weeks=vm.weeks;if(weeks){if(currentMonth=vm._selectedDate.getMonth(),currentYear=vm._selectedDate.getFullYear(),selectedMonth=selectedDate.getMonth(),selectedYear=selectedDate.getFullYear(),direction=0,currentYear===selectedYear?currentMonth!==selectedMonth&&(direction=selectedMonth>currentMonth?1:-1):direction=selectedYear>currentYear?1:-1,vm._selectedDate=selectedDate,ngModelCtrl&&ngModelCtrl.$setViewValue(selectedDate),0===direction)for(row=0;6>row;row+=1)for(date=0;7>date;date+=1)selected=0===compare(selectedDate,weeks[row][date]),weeks[row][date].selected=selected,selected&&(vm.selectedDate=weeks[row][date]);else refreshView();vm.timeSelected&&vm.timeSelected({selectedTime:selectedDate})}},vm.mode={step:{months:1}}}angular.module("ui.rCalendar.tpls",["template/rcalendar/calendar.html"]),angular.module("ui.rCalendar",["ui.rCalendar.tpls"]),angular.module("ui.rCalendar").constant("calendarConfig",{formatDay:"dd",formatDayHeader:"EEE",formatDayTitle:"MMMM dd, yyyy",formatMonthTitle:"MMMM yyyy",formatHourColumn:"dd MMMM, HH:mm",startingDay:0,eventSource:null,queryMode:"local"}),angular.module("ui.rCalendar").directive("calendar",function(){"use strict";return{restrict:"EA",replace:!0,templateUrl:"template/rcalendar/calendar.html",bindToController:!0,controllerAs:"vm",scope:{viewRefreshed:"&",eventSelected:"&",timeSelected:"&",showEventList:"=",showEventPins:"="},require:["calendar","?^ngModel"],controller:"ui.rCalendar.CalendarController",link:function(scope,element,attrs,ctrls){var vm=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&vm.init(ngModelCtrl),scope.$on("changeDate",function(event,direction){vm.move(direction)}),scope.$on("eventSourceChanged",function(event,value){vm.onEventSourceChanged(value)})}}}),angular.module("ui.rCalendar").controller("ui.rCalendar.CalendarController",CalendarController),CalendarController.$inject=["$scope","$attrs","$interpolate","$log","$mdMedia","$mdColors","dateFilter","calendarConfig"],angular.module("template/rcalendar/calendar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rcalendar/calendar.html",'<div layout="column" ng-cloak>\n	<div class="month-view">\n		<div layout="column" layout-gt-sm="row">\n			<div flex>\n				<md-card\n					id="calendar"\n					sticky\n					offset="0"\n					media-query="min-width: 960px"\n					class="event-inner"\n					md-swipe-left=\'vm.moveMonth(1)\'\n					md-swipe-right=\'vm.moveMonth(-1)\'>\n					<md-card-header layout=\'row\'\n									layout-align="space-between center"\n									sticky offset="0"\n									media-query="max-width: 959px"\n									sticky-class="sticked">\n						<md-button\n							class="md-icon-button"\n							ng-click="vm.moveMonth(-1)"\n							aria-label="Mês anterior">\n							<md-icon md-svg-icon="md-tabs-arrow">«</md-icon>\n						</md-button>\n						<div flex></div>\n						<h2 class="md-title">\n							<span>{{vm.title}}</span>\n						</h2>\n						<div flex></div>\n						<md-button\n							class="md-icon-button"\n							ng-click="vm.moveMonth(1)"\n							aria-label="Mês seguinte">\n							<md-icon md-svg-icon="md-tabs-arrow" class="moveNext"></md-icon>\n						</md-button>\n					</md-card-header>\n					<md-divider></md-divider>\n					<md-card-content>\n						<md-grid-list md-cols="7"\n									  md-row-height="3:1"\n									  md-gutter="0px">\n							<md-grid-tile md-rowspan="1"\n										  md-colspan="1"\n										  style="background: #fff"\n										  ng-repeat="label in vm.labels track by $index">\n								<small style="font-weight: bold;">{{label}}</small>\n							</md-grid-tile>\n						</md-grid-list>\n\n						<md-grid-list md-cols="7"\n									  md-row-height="1:1"\n									  md-row-height-gt-xs="3:2"\n									  md-gutter="0px">\n							<md-grid-tile md-rowspan="1"\n										  md-colspan="1"\n										  ng-repeat="dt in vm.weeks[0].concat(vm.weeks[1])\n																	.concat(vm.weeks[2])\n																	.concat(vm.weeks[3])\n																	.concat(vm.weeks[4])\n																	.concat(vm.weeks[5]) track by $index"\n										  ng-click="vm.select(dt)"\n										  class="monthview-dateCell"\n										  ng-focus="focus = true;"\n										  ng-blur="focus = false;"\n										  ng-mouseleave="hover = false"\n										  ng-mouseenter="hover = true"\n										  ng-class="{\n					  			\'md-whiteframe-8dp\': hover || focus,\n								\'monthview-current\': dt.current&&!dt.selected&&!dt.hasEvent,\n								\'monthview-secondary-with-event\': dt.secondary&&dt.hasEvent,\n								\'monthview-secondary\': dt.secondary,\n								\'monthview-selected\': dt.selected,\n								\'lastDayOfWeek\': (($index + 1) % 7) === 0\n								}">\n								<div ng-class="{\'text-muted\':dt.secondary}">\n								<span class="date md-subheader">\n									{{dt.label}}\n								</span>\n									<div ng-if="vm.showEventPins"\n										 class="month-events"\n										 ng-class="{ sm: vm.$mdMedia(\'gt-xs\'),\n												 md: vm.$mdMedia(\'gt-sm\'),\n												 lg: vm.$mdMedia(\'gt-md\')}">\n										<div class="month-event-pin left"\n											 ng-style="{\'background-color\': event.color || vm.defaultEventColor }"\n											 ng-repeat="event in dt.events | orderBy : \'color\' track by $index"></div>\n									</div>\n								</div>\n							</md-grid-tile>\n						</md-grid-list>\n					</md-card-content>\n				</md-card>\n			</div>\n			<md-card id="day-events"\n					 ng-if="vm.showEventList"\n					 flex\n					 md-swipe-left=\'vm.moveDay(1)\'\n					 md-swipe-right=\'vm.moveDay(-1)\'\n					 class="event-inner"\n					 ng-class="{ md: vm.$mdMedia(\'gt-sm\')}">\n				<md-card-header layout=\'row\'\n								layout-align="space-between center"\n								sticky\n								offset="55"\n								media-query="max-width: 959px"\n								sticky-class="sticked">\n					<md-card-header-text\n						layout\n						layout-align="center"\n						layout-align-gt-sm="start">\n						<span class="md-title">{{vm.selectedDate|date: vm.formatDay }}</span>\n						<span class="md-subhead">{{vm.selectedDate|date: \'EEEE\'}}</span>\n					</md-card-header-text>\n				</md-card-header>\n				<md-divider></md-divider>\n				<md-card-content>\n					<div ng-if="!vm.selectedDate.events">\n						<p>Nenhum evento encontrado</p>\n					</div>\n					<div class="event-inner md-whiteframe-2dp md-padding"\n						 ng-repeat="event in vm.selectedDate.events track by $index"\n						 ng-style="{\'background-color\': event.color || vm.defaultEventColor }">\n						<div class="md-body-2">\n							<strong>{{event.title}}</strong></div>\n						<div class="md-body-2">{{event.startTime|date: vm.formatHourColumn}} - {{event.endTime|date: vm.formatHourColumn}}</div>\n					</div>\n				</md-card-content>\n			</md-card>\n		</div>\n	</div>\n</div>\n')}]);