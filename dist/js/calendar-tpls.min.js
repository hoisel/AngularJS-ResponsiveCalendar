angular.module("ui.rCalendar.tpls",["template/rcalendar/calendar.html","template/rcalendar/day.html","template/rcalendar/month.html","template/rcalendar/week.html"]),angular.module("ui.rCalendar",["ui.rCalendar.tpls"]).constant("calendarConfig",{formatDay:"dd",formatDayHeader:"EEE",formatDayTitle:"MMMM dd, yyyy",formatWeekTitle:"MMMM yyyy, Week w",formatMonthTitle:"MMMM yyyy",formatWeekViewDayHeader:"EEE d",formatHourColumn:"MMMM dd, HH:mm",calendarMode:"month",showWeeks:!1,showEventDetail:!0,startingDay:0,eventSource:null,queryMode:"local"}).controller("ui.rCalendar.CalendarController",["$scope","$attrs","$parse","$interpolate","$log","$mdMedia","dateFilter","calendarConfig",function($scope,$attrs,$parse,$interpolate,$log,$mdMedia,dateFilter,calendarConfig){"use strict";var self=this,ngModelCtrl={$setViewValue:angular.noop};angular.forEach(["formatDay","formatDayHeader","formatDayTitle","formatWeekTitle","formatMonthTitle","formatWeekViewDayHeader","formatHourColumn","showWeeks","showEventDetail","startingDay","eventSource","queryMode"],function(key,index){self[key]=angular.isDefined($attrs[key])?7>index?$interpolate($attrs[key])($scope.$parent):$scope.$parent.$eval($attrs[key]):calendarConfig[key]}),$scope.$mdMedia=$mdMedia,$scope.$parent.$watch($attrs.eventSource,function(value){self.onEventSourceChanged(value)}),$scope.calendarMode=$scope.calendarMode||calendarConfig.calendarMode,angular.isDefined($attrs.initDate)&&(self.currentCalendarDate=$scope.$parent.$eval($attrs.initDate)),self.currentCalendarDate||(self.currentCalendarDate=new Date,$attrs.ngModel&&!$scope.$parent.$eval($attrs.ngModel)&&$parse($attrs.ngModel).assign($scope.$parent,self.currentCalendarDate)),self.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=function(){self.render()}},self.render=function(){if(ngModelCtrl.$modelValue){var date=new Date(ngModelCtrl.$modelValue),isValid=!isNaN(date);isValid?this.currentCalendarDate=date:$log.error('"ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),ngModelCtrl.$setValidity("date",isValid)}this.refreshView()},self.refreshView=function(){this.mode&&(this.range=this._getRange(this.currentCalendarDate),this._refreshView(),this.rangeChanged())},self.split=function(arr,size){for(var arrays=[];arr.length>0;)arrays.push(arr.splice(0,size));return arrays},self.onEventSourceChanged=function(value){self.eventSource=value,self._onDataLoaded&&self._onDataLoaded()},$scope.move=function(direction){var firstDayInNextMonth,step=self.mode.step,currentCalendarDate=self.currentCalendarDate,year=currentCalendarDate.getFullYear()+direction*(step.years||0),month=currentCalendarDate.getMonth()+direction*(step.months||0),date=currentCalendarDate.getDate()+direction*(step.days||0);currentCalendarDate.setFullYear(year,month,date),"month"===$scope.calendarMode&&(firstDayInNextMonth=new Date(year,month+1,1),firstDayInNextMonth.getTime()<=currentCalendarDate.getTime()&&(self.currentCalendarDate=new Date(firstDayInNextMonth-864e5))),ngModelCtrl.$setViewValue(self.currentCalendarDate),self.refreshView()},self.move=function(direction){$scope.move(direction)},self.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate())},self.rangeChanged=function(){"local"===self.queryMode?self.eventSource&&self._onDataLoaded&&self._onDataLoaded():"remote"===self.queryMode&&$scope.rangeChanged&&$scope.rangeChanged({startTime:this.range.startTime,endTime:this.range.endTime})}}]).directive("calendar",function(){"use strict";return{restrict:"EA",replace:!0,templateUrl:"template/rcalendar/calendar.html",scope:{calendarMode:"=",rangeChanged:"&",eventSelected:"&",timeSelected:"&"},require:["calendar","?^ngModel"],controller:"ui.rCalendar.CalendarController",link:function(scope,element,attrs,ctrls){var calendarCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&calendarCtrl.init(ngModelCtrl),scope.$on("changeDate",function(event,direction){calendarCtrl.move(direction)}),scope.$on("eventSourceChanged",function(event,value){calendarCtrl.onEventSourceChanged(value)})}}}).directive("monthview",["dateFilter",function(dateFilter){"use strict";return{restrict:"EA",replace:!0,templateUrl:"template/rcalendar/month.html",require:["^calendar","?^ngModel"],link:function(scope,element,attrs,ctrls){function generateDaysFrom(startDate,n){var dates=new Array(n),current=new Date(startDate),i=0;for(current.setHours(12);n>i;)dates[i++]=new Date(current),current.setDate(current.getDate()+1);return dates}function createDateMetadata(date){return{label:dateFilter(date,calendarCtrl.formatDay),headerLabel:dateFilter(date,calendarCtrl.formatDayHeader),selected:0===calendarCtrl.compare(date,calendarCtrl.currentCalendarDate),current:0===calendarCtrl.compare(date,new Date)}}function compareEvent(event1,event2){return event1.startTime.getTime()-event2.startTime.getTime()}function select(selectedDate){var weeks=scope.weeks;if(weeks){var currentCalendarDate=calendarCtrl.currentCalendarDate,currentMonth=currentCalendarDate.getMonth(),currentYear=currentCalendarDate.getFullYear(),selectedMonth=selectedDate.getMonth(),selectedYear=selectedDate.getFullYear(),direction=0;if(currentYear===selectedYear?currentMonth!==selectedMonth&&(direction=selectedMonth>currentMonth?1:-1):direction=selectedYear>currentYear?1:-1,calendarCtrl.currentCalendarDate=selectedDate,ngModelCtrl&&ngModelCtrl.$setViewValue(selectedDate),0===direction)for(var row=0;6>row;row+=1)for(var date=0;7>date;date+=1){var selected=0===calendarCtrl.compare(selectedDate,weeks[row][date]);weeks[row][date].selected=selected,selected&&(scope.selectedDate=weeks[row][date])}else calendarCtrl.refreshView();scope.timeSelected&&scope.timeSelected({selectedTime:selectedDate})}}var calendarCtrl=ctrls[0],ngModelCtrl=ctrls[1];scope.formatHourColumn=calendarCtrl.formatHourColumn,scope.showEventDetail=calendarCtrl.showEventDetail,scope.select=select,calendarCtrl.mode={step:{months:1}},calendarCtrl._refreshView=function(){for(var startDate=calendarCtrl.range.startTime,day=startDate.getDate(),month=(startDate.getMonth()+(1!==day?1:0))%12,year=startDate.getFullYear()+(1!==day&&0===month?1:0),days=generateDaysFrom(startDate,42),i=0;42>i;i++)angular.extend(days[i],createDateMetadata(days[i]),{secondary:days[i].getMonth()!==month});scope.labels=new Array(7);for(var j=0;7>j;j++)scope.labels[j]=dateFilter(days[j],calendarCtrl.formatDayHeader);var headerDate=new Date(year,month,1);scope.$parent.title=dateFilter(headerDate,calendarCtrl.formatMonthTitle),scope.weeks=calendarCtrl.split(days,7)},calendarCtrl._onDataLoaded=function(){var row,date,events=calendarCtrl.eventSource,len=events?events.length:0,startTime=calendarCtrl.range.startTime,endTime=calendarCtrl.range.endTime,weeks=scope.weeks,oneDay=864e5,eps=.001,hasEvent=!1;if(weeks.hasEvent)for(row=0;6>row;row+=1)for(date=0;7>date;date+=1)weeks[row][date].hasEvent&&(weeks[row][date].events=null,weeks[row][date].hasEvent=!1);for(var i=0;len>i;i+=1){var st,et,event=events[i],eventStartTime=new Date(event.startTime),eventEndTime=new Date(event.endTime);if(!(startTime>=eventEndTime||eventStartTime>=endTime)){st=startTime,et=endTime;var timeDifferenceStart;timeDifferenceStart=st>=eventStartTime?0:(eventStartTime-st)/oneDay;var timeDifferenceEnd;timeDifferenceEnd=eventEndTime>=et?(et-st)/oneDay:(eventEndTime-st)/oneDay;for(var eventSet,index=Math.floor(timeDifferenceStart);timeDifferenceEnd-eps>index;){var rowIndex=Math.floor(index/7),dayIndex=Math.floor(index%7);weeks[rowIndex][dayIndex].hasEvent=!0,eventSet=weeks[rowIndex][dayIndex].events,eventSet?eventSet.push(event):(eventSet=[],eventSet.push(event),weeks[rowIndex][dayIndex].events=eventSet),index+=1}}}for(row=0;6>row;row+=1)for(date=0;7>date;date+=1)weeks[row][date].hasEvent&&(hasEvent=!0,weeks[row][date].events.sort(compareEvent));weeks.hasEvent=hasEvent;var findSelected=!1;for(row=0;6>row;row+=1){for(date=0;7>date;date+=1)if(weeks[row][date].selected){scope.selectedDate=weeks[row][date],findSelected=!0;break}if(findSelected)break}},calendarCtrl._getRange=function(currentDate){var endDate,year=currentDate.getFullYear(),month=currentDate.getMonth(),firstDayOfMonth=new Date(year,month,1),difference=calendarCtrl.startingDay-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,startDate=new Date(firstDayOfMonth);return numDisplayedFromPreviousMonth>0&&startDate.setDate(-numDisplayedFromPreviousMonth+1),endDate=new Date(startDate),endDate.setDate(endDate.getDate()+42),{startTime:startDate,endTime:endDate}},calendarCtrl.refreshView()}}}]),angular.module("template/rcalendar/calendar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rcalendar/calendar.html",'<div ng-switch="calendarMode" layout="column" ng-cloak>\n	<md-toolbar>\n		<div class=\'md-toolbar-tools\' layout=\'row\'>\n			<md-button class="md-icon-button" ng-click="move(-1)" aria-label="Mês anterior">\n				<md-icon md-svg-icon="md-tabs-arrow">«</md-icon>\n			</md-button>\n			<div flex></div>\n			<h2 class=\'calendar-md-title\'>\n				<span>{{title}}</span></h2>\n			<div flex></div>\n			<md-button class="md-icon-button" ng-click="move(1)" aria-label="Mês seguinte">\n				<md-icon md-svg-icon="md-tabs-arrow" class="moveNext"></md-icon>\n			</md-button>\n		</div>\n	</md-toolbar>\n	<md-content layout-fill md-swipe-left=\'move(1)\' md-swipe-right=\'move(-1)\'>\n		<dayview ng-switch-when="day"></dayview>\n		<monthview ng-switch-when="month"></monthview>\n	</md-content>\n</div>\n')}]),angular.module("template/rcalendar/day.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rcalendar/day.html",'<div>\n	<md-list>\n		<md-list-item layout="row" layout-align="start start">\n			<div flex="15"></div>\n			<div layout="column" layout-fill flex="85">\n				<md-subheader class="md-no-sticky">19-25 jun</md-subheader>\n			</div>\n		</md-list-item>\n\n		<md-list-item layout="row" layout-align="start start">\n			<div flex="15">\n				<div class="md-display-1">{{day.date.getDate()}}</div>\n				<div class="md-body-2">{{day.label}}</div>\n			</div>\n\n			<div layout="column" layout-fill flex="85">\n				<div class="calendar-event-inner" ng-repeat="event in day.allDayEvents track by $index">\n					<div class="md-title">{{event.title}}</div>\n					<div class="md-body-2">O dia todo</div>\n				</div>\n			</div>\n		</md-list-item>\n\n		<md-list-item layout="row" layout-align="start start">\n			<div flex="15"></div>\n\n			<div layout="column" layout-fill flex="85">\n				<div class="calendar-event-inner" ng-repeat="event in day.events track by $index">\n					<div class="md-title">{{event.title}}</div>\n					<div class="md-body-2">{{event.startTime|date: formatHourColumn}} - {{event.endTime|date: formatHourColumn}}</div>\n				</div>\n			</div>\n		</md-list-item>\n	</md-list>\n</div>')}]),angular.module("template/rcalendar/month.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rcalendar/month.html",'<div class="md-padding month-view">\n	<!--\n		<div style="position:  fixed;">\n			<div ng-show="$mdMedia(\'gt-xs\')">\n				SMALL\n			</div>\n\n			<div ng-show="$mdMedia(\'gt-sm\')">\n				MEDIUM\n			</div>\n\n			<div ng-show="$mdMedia(\'gt-md\')">\n				LARGE\n			</div>\n\n			<div ng-show="$mdMedia(\'xl\')">\n				X-LARGE\n			</div>\n		</div>-->\n	<div layout="column" layout-gt-sm="row">\n		<div flex flex-gt-sm="60" flex-gt-lg="80">\n			<md-grid-list md-cols="7"\n						  md-row-height="3:1"\n						  md-gutter="0px">\n				<md-grid-tile md-rowspan="1"\n							  md-colspan="1"\n							  ng-repeat="label in labels track by $index">\n					<small style="font-weight: bold;">{{label}}</small>\n				</md-grid-tile>\n			</md-grid-list>\n\n			<md-grid-list md-cols="7"\n						  md-row-height="1:1"\n						  md-row-height-gt-xs="3:2"\n						  md-gutter="0px">\n				<md-grid-tile md-rowspan="1"\n							  md-colspan="1"\n							  ng-repeat="dt in weeks[0].concat(weeks[1])\n					  						  .concat(weeks[2])\n					  						  .concat(weeks[3])\n					  						  .concat(weeks[4])\n					  						  .concat(weeks[5]) track by dt"\n							  ng-click="select(dt)"\n							  class="monthview-dateCell"\n							  ng-focus="focus = true;"\n							  ng-blur="focus = false;"\n							  ng-mouseleave="hover = false"\n							  ng-mouseenter="hover = true"\n							  ng-class="{\n					  			\'md-whiteframe-12dp\': hover || focus,\n								\'monthview-current\': dt.current&&!dt.selected&&!dt.hasEvent,\n								\'monthview-secondary-with-event\': dt.secondary&&dt.hasEvent,\n								\'monthview-secondary\': dt.secondary,\n								\'monthview-selected\': dt.selected,\n								\'lastDayOfWeek\': (($index + 1) % 7) === 0\n								}">\n					<div ng-class="{\'text-muted\':dt.secondary}">\n						<span class="date">\n							{{dt.label}}\n						</span>\n						<div class="month-events" ng-class="{ sm: $mdMedia(\'gt-xs\'),  md: $mdMedia(\'gt-sm\'), lg: $mdMedia(\'gt-md\')}">\n							<div class="month-event left" ng-repeat="ev in dt.events track by ev.title">\n							</div>\n						</div>\n					</div>\n				</md-grid-tile>\n			</md-grid-list>\n		</div>\n\n		<md-list id="events-detail"\n				 ng-if="showEventDetail"\n				 ng-class="{ md: $mdMedia(\'gt-sm\')}"\n				 flex\n				 flex-gt-sm="40"\n				 flex-gt-lg="20">\n			<md-list-item layout="row" layout-align="start start">\n				<div flex="15"></div>\n				<div layout="column" layout-fill flex="85">\n					<md-subheader class="md-no-sticky">19-25 jun</md-subheader>\n				</div>\n			</md-list-item>\n\n			<md-list-item layout="row" layout-align="start start">\n				<div flex="15">\n					<div class="md-display-1">{{selectedDate.getDate()}}</div>\n\n					<div class="md-body-2">{{selectedDate.headerLabel}}</div>\n				</div>\n\n				<div layout="column" layout-fill flex="85">\n					<div class="calendar-event-inner" ng-repeat="event in selectedDate.events track by $index">\n						<div class="md-title">{{event.title}}</div>\n						<div class="md-body-2">{{event.startTime|date: formatHourColumn}} - {{event.endTime|date: formatHourColumn}}</div>\n					</div>\n				</div>\n			</md-list-item>\n\n		<!--	<md-list-item layout="row" layout-align="start start">\n				<div flex="15"></div>\n\n				<div layout="column" layout-fill flex="85">\n					<div class="calendar-event-inner" ng-repeat="event in day.events track by $index">\n						<div class="md-title">{{event.title}}</div>\n						<div class="md-body-2">{{event.startTime|date: formatHourColumn}} - {{event.endTime|date: formatHourColumn}}</div>\n					</div>\n				</div>\n			</md-list-item>-->\n		</md-list>\n\n		<!--\n		<md-list id="events-detail"\n				 ng-if="showEventDetail"\n				 ng-class="{ md: $mdMedia(\'gt-sm\')}"\n				 flex\n				 flex-gt-sm="40"\n				 flex-gt-lg="20">\n\n			<md-subheader ng-if="$mdMedia(\'gt-sm\')">Eventos do dia: {{selectedDate.date|date: \'dd/MM/yyyy\'}}</md-subheader>\n			<md-list-item ng-repeat="event in selectedDate.events" ng-if="selectedDate.events" layout="row">\n\n				&lt;!&ndash;<div flex="5" flex-gt-md="5" layout="row" layout-align="center center">\n					<div ng-class="{ sm: $mdMedia(\'gt-xs\'),  md: $mdMedia(\'gt-sm\'), lg: $mdMedia(\'gt-md\')}">\n						<div class="month-event">\n						</div>\n					</div>\n				</div>&ndash;&gt;\n				<div flex="30"\n					 flex-gt-md="20"\n					 flex-xl="25"\n					 class="event-time-column">\n					<small ng-if="!event.allDay">\n						{{event.startTime|date: \'HH:mm\'}} - {{event.endTime|date: \'HH:mm\'}}\n					</small>\n					<small ng-if="event.allDay">O dia todo</small>\n				</div>\n				<div flex="70"\n					 flex-gt-md="80"\n					 flex-xl="85"\n					 class="event-detail-column">\n					<span class="event-detail-title" ng-click="eventSelected({event:event})"> {{event.title}}</span><br>\n					&lt;!&ndash;<small class="event-detail-body" ng-if="event.description"> {{event.description}}</small>&ndash;&gt;\n					<md-divider ng-if="!$last"></md-divider>\n				</div>\n\n			</md-list-item>\n\n			<md-list-item ng-if="!selectedDate.events">\n				<span>Sem Eventos</span>\n			</md-list-item>\n		</md-list>-->\n\n		<!--\n				<div ng-if="showEventDetail"\n					 class="event-detail-container"\n					 flex\n					 flex-gt-md="30"\n					 flex-gt-lg="20">\n					<div class="scrollable" style="height: 200px">\n						<table>\n							<tr ng-repeat="event in selectedDate.events" ng-if="selectedDate.events">\n								<td ng-if="!event.allDay" class="monthview-eventdetail-timecolumn">{{event.startTime|date: \'HH:mm\'}}\n									-\n									{{event.endTime|date: \'HH:mm\'}}\n								</td>\n								<td ng-if="event.allDay" class="monthview-eventdetail-timecolumn">All day</td>\n								<td class="event-detail" ng-click="eventSelected({event:event})">{{event.title}}</td>\n							</tr>\n							<tr ng-if="!selectedDate.events">\n								<td class="no-event-label">No Events</td>\n							</tr>\n						</table>\n					</div>\n				</div>-->\n	</div>\n</div>')}]),angular.module("template/rcalendar/week.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rcalendar/week.html",'<div>\n    <table class="table table-bordered table-fixed weekview-header">\n        <thead>\n        <tr>\n            <th class="calendar-hour-column"></th>\n            <th ng-repeat="dt in dates" class="text-center weekview-header-label">{{dt.date| date:\n                formatWeekViewDayHeader}}\n            </th>\n            <th ng-if="gutterWidth>0" class="gutter-column" ng-style="{width: gutterWidth+\'px\'}"></th>\n        </tr>\n        </thead>\n    </table>\n    <div class="weekview-allday-table">\n        <div class="weekview-allday-label">\n            all day\n        </div>\n        <div class="weekview-allday-content-wrapper">\n            <table class="table table-bordered table-fixed weekview-allday-content-table">\n                <tbody>\n                <tr>\n                    <td ng-repeat="day in dates track by day.date" class="calendar-cell">\n                        <div ng-class="{\'calendar-event-wrap\': day.events}" ng-if="day.events"\n                             ng-style="{height: 25*day.events.length+\'px\'}">\n                            <div ng-repeat="displayEvent in day.events" class="calendar-event"\n                                 ng-click="eventSelected({event:displayEvent.event})"\n                                 ng-style="{top: 25*displayEvent.position+\'px\', width: 100*(displayEvent.endIndex-displayEvent.startIndex)+\'%\', height: \'25px\'}">\n                                <div class="calendar-event-inner">{{displayEvent.event.title}}</div>\n                            </div>\n                        </div>\n                    </td>\n                    <td ng-if="allDayEventGutterWidth>0" class="gutter-column"\n                        ng-style="{width: allDayEventGutterWidth+\'px\'}"></td>\n                </tr>\n                </tbody>\n            </table>\n        </div>\n    </div>\n    <div class="scrollable" style="height: 400px">\n        <table class="table table-bordered table-fixed">\n            <tbody>\n            <tr ng-repeat="row in rows track by $index">\n                <td class="calendar-hour-column text-center">\n                    {{row[0].time | date: formatHourColumn}}\n                </td>\n                <td ng-repeat="tm in row track by tm.time" class="calendar-cell" ng-click="select(tm.time)">\n                    <div ng-class="{\'calendar-event-wrap\': tm.events}" ng-if="tm.events">\n                        <div ng-repeat="displayEvent in tm.events" class="calendar-event"\n                             ng-click="eventSelected({event:displayEvent.event})"\n                             ng-style="{left: 100/displayEvent.overlapNumber*displayEvent.position+\'%\', width: 100/displayEvent.overlapNumber+\'%\', height: 37*(displayEvent.endIndex-displayEvent.startIndex)+\'px\'}">\n                            <div class="calendar-event-inner">{{displayEvent.event.title}}</div>\n                        </div>\n                    </div>\n                </td>\n                <td ng-if="normalGutterWidth>0" class="gutter-column" ng-style="{width: normalGutterWidth+\'px\'}"></td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n</div>')}]);